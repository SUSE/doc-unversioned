<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook50-profile.xsl"
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE article
[
<!ENTITY % entities SYSTEM "generic-entities.ent">
%entities;
<!ENTITY productnamex "<phrase xmlns='http://docbook.org/ns/docbook' os='sles;sled;osuse'>&productname;</phrase><phrase xmlns='http://docbook.org/ns/docbook' os='article'>&sls;</phrase>">
<!ENTITY productnumberx "<phrase xmlns='http://docbook.org/ns/docbook' os='sles;sled;osuse'>&productnumber;</phrase>">
]>

<article xml:id="article-openscap"
 xmlns="http://docbook.org/ns/docbook"
 version="5.0"
 xml:lang="en"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink">

 <title>Hardening &sle; with &openscap;</title>
 <titleabbrev>Hardening &sle; with &openscap;</titleabbrev>
 <info>
  <productname>&productnamex;</productname>
  <productnumber>&productnumberx;</productnumber>
  <date><?dbtimestamp format="B d, Y"?></date>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker>
    <dm:url>https://bugzilla.suse.com/enter_bug.cgi</dm:url>
    <dm:component>Security</dm:component>
    <dm:product>Documentation</dm:product>
    <dm:assignee>taroth@suse.com</dm:assignee>
   </dm:bugtracker>
   <dm:editurl>https://github.com/SUSE/doc-unversioned/blob/main/hipaa/xml/</dm:editurl>
   <dm:translation>no</dm:translation>
  </dm:docmanager>

  <abstract>
   <para>
    This document explains how to assess, measure and enforce security baselines with the help
    of &openscap;.
   </para>
  </abstract>
 </info>

 <sect1 xml:id="openscap-whatis">
  <title>What are SCAP and &openscap;?</title>

  <para>
   SCAP stands for <systemitem class="protocol">Security Content Automation Protocol</systemitem>.
   It is a framework of specifications that support automated configuration, vulnerability scanning,
   and policy compliance evaluation of systems deployed in an organization. It also standardizes how
   vulnerabilities and security configurations are communicated both to machines and human beings.
  </para>

  <para>&openscap; is a collection of open source tools that implement the SCAP framework, which is
   maintained by the <orgname>National Institute of Standards and Technology (NIST)</orgname>.
   &openscap; has received the SCAP 1.2 certification by NIST in 2014.
  </para>
 </sect1>

 <sect1 xml:id="openscap-benefits">
  <title>Benefits</title>

  <para>
   The &openscap; tools, together with the <literal>SCAP
    Security Guide</literal>, can be used for auditing your system in an
   automated way. The <literal>SCAP Security Guide</literal> implements
   security guidances recommended by respected authorities. These security
   guidances are transformed into a machine readable format which then can
   be used by &openscap;.
  </para>
 </sect1>

 <sect1 xml:id="openscap-components">
  <title>SCAP components</title>
  <para>
   SCAP consists of the following important components which interact with each other.
  </para>
  <variablelist>
   <varlistentry>
    <term>Open Vulnerability and Assessment Language (OVAL)</term>
    <listitem>
     <para>
      An XML format for testing the presence of a specific state.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Extensible Configuration Checklist Description Format (XCCDF)</term>
    <listitem>
     <para>
      An XML format that specifies security checklists, benchmarks, and configuration
      documentation. The XCCDF file includes a benchmark as a set of different profiles
      related to different groups. Each group is a set of rules which have OVAL definitions.
      Each profile is related to different good practices such as STIG, HIPAA, PCI-DSS, or ANSSI.</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Common Platform Enumeration (CPE)</term>
    <listitem>
     <para>
      A structured naming scheme to identify information technology systems, platforms, and
      software packages. It is maintained by NIST and NDV. The naming scheme consists of the following
      elements:
      <literal>cpe:/<replaceable>part</replaceable>:<replaceable>vendor</replaceable>:<replaceable>product</replaceable>:<replaceable>version</replaceable>:<replaceable>update</replaceable>:<replaceable>edition</replaceable>:<replaceable>language</replaceable></literal>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>DataStreams (DS)</term>
    <listitem>
     <para>
      An XML format which packs different SCAP components (CPE, XCCDF, OVAL) into a single file.
      It can be used to distribute SCAP content over the network. The DataStreams files are
      very useful because they include everything you need when you want to harden and audit
      your &sle; system.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Common Configuration Enumeration (CCE)</term>
    <listitem>
     <para>
      Unique identifiers to security-related system configuration issues.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>

 <sect1 xml:id="openscap-ssg">
  <title>SCAP Security Guide</title>

  <para>
   &suse; ships the <literal>SCAP Security Guide</literal> (SSG) toolset in the
   <package>scap-security-guide</package> RPM package. It contains the latest set
   of security polices for Linux systems. The <literal>SCAP Security Guide</literal>
   is maintained upstream in the <link xlink:href="https://github.com/ComplianceAsCode/"
    >ComplianceAsCode</link> repository.
   </para>
   <para>
   After you have installed the package, the SSG security content and the related files
   are available in your system from the following directories:</para>
  <variablelist>
   <title>Overview of files and directories</title>
   <varlistentry>
    <term><filename>/usr/share/xml/scap/ssg/content/</filename></term>
    <listitem>
     <para>
      Contains the SSG security content. It consists of several <xref linkend="openscap-components"
      xrefstyle="title"/>, which are all based on XML. All XML files in that directory are named
      according to the SCAP component and to the &sle; codestream they apply to (code 12 or 15).
      The directory also holds XML files specific to &osuse;.
     </para>
    </listitem>
   </varlistentry>
    <varlistentry>
     <term><filename>/usr/share/doc/scap-security-guide/guides/</filename></term>
     <listitem>
      <para>
       Contains profiles for different hardening policies in human-readable format.
       They describe the profiles that are included in the Datastream files.
       The profiles applicable to &sle; are codestream-specific and differ between
       code 12 and code 15. Each profile is a guide how to secure your operating system
       according to a regulation that you want your system to comply with.
      </para>
      <para>
       The guides usually have the following structure:
      </para>
      <itemizedlist>
       <listitem>
        <para>
         Short description.
        </para>
       </listitem>
       <listitem>
        <para>
         Profile Title. For example: <citetitle>DISA STIG for &sle; 15</citetitle>
        </para>
       </listitem>
       <listitem>
        <para>
         Profile ID. For example: <citetitle>xccdf_org.ssgproject.content_profile_stig</citetitle>
        </para>
       </listitem>
       <listitem>
        <para>
         Revision History. Information about the current version and status of the profile.
         For example: <citetitle>xccdf_org.ssgproject.content_profile_stig</citetitle>
        </para>
       </listitem>
       <listitem>
        <para>
         Platforms (in CPE notation). Which product or system the profile applies to.
         For example: <citetitle>cpe:/o:suse:linux_enterprise_server:15</citetitle>
        </para>
       </listitem>
       <listitem>
        <para>
         A table of contents.
        </para>
       </listitem>
       <listitem>
        <para>
         A checklist which consists of groups (and subgroups) with rules.
        </para>
        <para>
         Each rule consists of a short description, the rationale behind the rule,
         a severity (low, medium, or high) and a unique identifier in 
         <literal>Common Configuration Enumeration (CCE)</literal> format. The CCE number
         for each number is provided to &suse; by NIST.
        </para>
        <para>
         Each rule also provides a list of references to different good practices. For example, the rule
         which is known by the unique identifier <literal>CCE-83289-9</literal> in STIG has a reference to
         a specific good practice <literal>A.12.4.1</literal> in ISO/IEC 27001:2013.
        </para>
        <para>
         If remediation options exist for a rule, they are listed in different formats.
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>/usr/share/scap-security-guide</filename></term>
     <listitem>
      <para>
       Contains subdirectories with fix scripts which can be used to remediate the target system
       in case a vulnerability is found during a scan. Fix scripts can be available in the following
       two formats: Shell scripts (<filename>bash/<replaceable>*.sh</replaceable></filename>) and Ansible
       snippets <filename>ansible/<replaceable>*.yml</replaceable></filename>.
       <!--taroth 2022-10-28: I suppose SUSE does not support nor ship the following formats:
       'Puppet snippet' and 'OSBuild Blueprint' snippet - at least there are no subdirectories within
       /usr/share/scap-security-guide (apart from an empty kickstart directory, which probably should
       not be there at all?!?) - answer by msmeissn: yes, we support only shell and ansible currently.-->
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
 </sect1>


 <sect1 xml:id="openscap-ssg-profiles">
  <title>SCAP Security Guide profiles</title>
  <para>The <literal>SCAP Security Guide</literal> contains multiple
   profiles. The profiles applicable to &sle; are codestream-specific
   and differ between code 12 and code 15.</para>
  <para>They are maintained and hosted in an upstream repository: </para>
  <itemizedlist>
   <listitem>
    <para>
     <link
      xlink:href="https://github.com/ComplianceAsCode/content/tree/master/products/sle15/profiles"
     />
    </para>
   </listitem>
   <listitem>
    <para>
     <link
      xlink:href="https://github.com/ComplianceAsCode/content/tree/master/products/sle12/profiles"
      > </link>
    </para>
   </listitem>
  </itemizedlist>
  <para>
   Human-readable versions of the profiles are available in your installed system in
   <filename>/usr/share/doc/scap-security-guide/guides</filename>.
  </para>
  <para>
   Alternatively, find the same content online as static HTML pages:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     <link xlink:href="https://static.open-scap.org/ssg-guides/ssg-sle15-guide-index.html"></link>
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="https://static.open-scap.org/ssg-guides/ssg-sle12-guide-index.html"></link>
    </para>
   </listitem>
  </itemizedlist>
  <para>In the online versions, use the drop-down box at the upper right corner of
   the page to select one of the available profiles and to view a command line
   snippet how to evaluate the respective profile with &openscap;.
  </para>
  <sect2 xml:id="openscap-ssg-profiles-sle15">
   <title>&sle; 15 profiles</title>
  <para>
   For code 15, the following profiles are supported by &suse;:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     ANSSI-BP-028 (enhanced)
    </para>
   </listitem>
   <listitem>
    <para>
     ANSSI-BP-028 (high)
    </para>
   </listitem>
   <listitem>
    <para>
     ANSSI-BP-028 (intermediary)
    </para>
   </listitem>
   <listitem>
    <para>
     ANSSI-BP-028 (minimal)
    </para>
   </listitem>
   <!--<listitem>
    <para>
     CIS SUSE &sle; 15 Benchmark Level 2 (Workstation)
    </para>
   </listitem>
   <listitem>
    <para>
     CIS &sle; 15 Benchmark for Level 1 (Server)
    </para>
   </listitem>
   <listitem>
    <para>
     CIS &sle; 15 Benchmark for Level 1 (Workstation)
    </para>
   </listitem>
   <listitem>
    <para>
     CIS &sle; 15 Benchmark for Level 2 (Server)
    </para>
   </listitem>-->
   <listitem>
    <para>
     DISA STIG for &sle; 15
    </para>
   </listitem>
   <listitem>
    <para>
     Health Insurance Portability and Accountability Act (HIPAA)
    </para>
   </listitem>
   <listitem>
    <para>
     PCI-DSS v.3.2.1 Control Baseline for &sle; 15
    </para>
   </listitem>
   <listitem>
    <para>
     Public Cloud Hardening for &sle; 15
    </para>
   </listitem>
   <!--<listitem>
    <para>
     Standard System Security Profile for &sle; 15
    </para>
   </listitem>-->
  </itemizedlist>
   <figure>
    <title>SCAP Security Guide profiles for &sle; 15</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="openscap-ssg-static-html-sle15.png" width="95%"></imagedata>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="openscap-ssg-static-html-sle15.png" width="90%"></imagedata>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>
  <sect2 xml:id="openscap-ssg-profiles-sle12">
   <title>&sle; 12 profiles</title>
   <para>
    For code 12, the following profiles are supported by &suse;:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      ANSSI-BP-028 (enhanced)
     </para>
    </listitem>
    <listitem>
     <para>
      ANSSI-BP-028 (high)
     </para>
    </listitem>
    <listitem>
     <para>
      ANSSI-BP-028 (intermediary)
     </para>
    </listitem>
    <listitem>
     <para>
      ANSSI-BP-028 (minimal)
     </para>
    </listitem>
    <!--<listitem>
     <para>
     CIS SUSE &sle; 12 Benchmark Level 2 (Workstation)
     </para>
     </listitem>
     <listitem>
     <para>
     CIS &sle; 12 Benchmark for Level 1 (Server)
     </para>
     </listitem>
     <listitem>
     <para>
     CIS &sle; 12 Benchmark for Level 1 (Workstation)
     </para>
     </listitem>
     <listitem>
     <para>
     CIS &sle; 12 Benchmark for Level 2 (Server)
     </para>
     </listitem>-->
    <listitem>
     <para>
      DISA STIG for &sle; 12
     </para>
    </listitem>
    <!--<listitem>
     <para>
      Health Insurance Portability and Accountability Act (HIPAA)
     </para>
    </listitem>
    <listitem>
     <para>
      PCI-DSS v.3.2.1 Control Baseline for &sle; 12
     </para>
    </listitem>
    <listitem>
     <para>
      Public Cloud Hardening for &sle; 12
     </para>
    </listitem>-->
    <!--<listitem>
     <para>
     Standard System Security Profile for &sle; 12
     </para>
     </listitem>-->
   </itemizedlist>
   <figure>
    <title>SCAP Security Guide profiles for &sle; 12</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="openscap-ssg-static-html-sle12.png" width="95%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="openscap-ssg-static-html-sle12.png" width="90%"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>
 </sect1>

 <sect1 xml:id="openscap-scan">
  <title>Vulnerability scanning</title>
  <sect2 xml:id="openscap-scan-targets">
   <title>Targets</title>
  <para>
   The content provided by the <literal>SCAP Security Guide</literal> can be used to scan the following targets
   for vulnerabilities:
  </para>
  <itemizedlist>
   <listitem>
    <para>bare-metal machines</para>
   </listitem>
   <listitem>
    <para>virtual machines</para>
   </listitem>
   <listitem>
    <para>virtual machine images</para>
   </listitem>
   <listitem>
    <para>containers</para>
   </listitem>
   <listitem>
    <para>container images</para>
   </listitem>
  </itemizedlist>
  <para>
   Automated checks help to identify the target and to select only the rules that make sense for this specific
   target. For example, checks for separate partitions make sense on bare-metal machines but not for containers.
  </para>
  </sect2>
  <sect2 xml:id="openscap-scan-tools">
   <title>Tools</title>
  <para>
   Depending on your setup and the target to scan (remote or local), you can use either of the following tools:
  </para>
  <variablelist>
   <varlistentry>
    <term>oscap</term>
    <listitem>
     <para>
      A command line interface that can be used to scan local machines. Both the <package>openscap-utils</package> and
      <package>scap-security-guide</package> package need to be installed on the local machine.
     </para>
    </listitem>
   </varlistentry>
    <varlistentry>
     <term>SCAP Workbench</term>
     <listitem>
      <para>
       A graphical user interface that can be used for scanning a single machine, either local or remote (via SSH).
       Both the <package>scap-workbench</package> and <package>scap-security-guide</package> package need to be installed
       on the local machine. On the remote machine the <package>openscap-utils</package> package needs to be
       installed.
      </para>
     </listitem>
    </varlistentry>
   <varlistentry>
    <term>oscap-ssh</term>
    <listitem>
     <para>
      A command line interface that can be used to scan a remote machine via SSH with an interface resembling
      the <command>oscap</command> tool. On the local machine, the package <package>openscap-utils</package>
      needs to be installed. On the remote machine, the <package>openscap-utils</package> package needs
      to be installed.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  </sect2>
  <sect2 xml:id="openscap-scan-sle15">
   <title>Scanning &productnamex;</title>
   <para>
    There are several options to scan &productnamex; for vulnerability issues based on a certain profile:
   </para>
   <itemizedlist>
    <listitem>
     <para>via <command>oscap</command></para>
    </listitem>
    <listitem>
     <para>via shell</para>
    </listitem>
   </itemizedlist>
   <para>
    For the following example, we assume that you want to scan &productnamex; 15 and generate a report.
   </para>
   <example xml:id="ex-openscap-oscap-sle15">
   <title>Scanning with oscap</title>
   <screen>&prompt.sudo;<command>oscap</command> xccdf eval \
    --profile <replaceable>stig</replaceable><co xml:id="co-eval-profile"/> \
    --results <replaceable>/tmp/results.xml</replaceable><co xml:id="co-eval-results"/> \
    --report <replaceable>/tmp/report.html</replaceable><co xml:id="co-eval-report"/> \
    /usr/share/xml/scap/ssg/content/ssg-sle15-ds-1.2.xml<co xml:id="co-eval-ssg"/></screen>
   <calloutlist>
    <callout arearefs="co-eval-profile">
     <para>
      Specifies the profile to use, in this case, <literal>stig</literal>.
     </para>
    </callout>
    <callout arearefs="co-eval-results">
     <para>
      Saves the results of the evaluation to <filename>/tmp/results.xml</filename>
     </para>
    </callout>
    <callout arearefs="co-eval-report">
     <para>
      Generates a HTML report called <filename>/tmp/report.html</filename> in
      addition to the results in XML.
     </para>
    </callout>
    <callout arearefs="co-eval-ssg">
     <para>
      <literal>Scap Security Guide</literal> (SSG) policy file in the
      <literal>datastream</literal> (ds) format. Make sure to select the correct
      version for your system, in this case the one that applies to code 15.
      To list all available policies, run:
      <command>ls -1 /usr/share/xml/scap/ssg/content/ssg-*-ds.xml</command>.For
      more information about a particular policy, run
      <command>oscap info</command> on the file.
     </para>
    </callout>
   </calloutlist>
   <para>
    The evaluation process usually takes a few minutes, depending on the number of
    selected rules.
   </para>
   </example>
   <para>
    If you want to use the shell instead, run the following command:
   </para>
   <screen>&prompt.sudo; /usr/share/scap-security-guide/bash/sle15-script-stig.sh</screen>
   <para>
    The shell script is standalone. If you do not want to install the complete
    <package>scap-security-guide</package> package, you can copy it out of the RPM.
   </para>
  </sect2>
 </sect1>

 <sect1>
  <title>Vulnerability remediation</title>
  <!--taroth 2022-10-20: todo: oscap, scap-workbench, ansible playbooks, bash scripts-->
  <para>
   The security policy profiles in the <literal>SCAP Security Guide</literal> can not only be used to scan a
   target system and to generate reports, but also to apply fixes automatically to the target system
   (<literal>remediation</literal>), if possible.
  </para>
  <important>
   <title>Automatic remediation not always available</title>
   <para>
    Automatic remediation is <emphasis>not</emphasis> offered in case the automatic application of a fix
    is too dangerous to be enforced in a running target system.
   </para>
  </important>
  <para>
   &openscap; allows to automatically remediate target systems that have been found in a non-compliant state.
   This requires an XCCDF file with instructions. The overall process is as follows:
  </para>
  <procedure>
   <step>
    <para>
     The <command>oscap</command> command line tool performs a system scan.
    </para>
   </step>
   <step>
    <para>
     Each rule that fails is marked as a candidate for remediation.
    </para>
   </step>
   <step>
    <para>
     Within the XCCDF file, <command>oscap</command> then searches for an appropriate
     &gt;xccdf:fix&lt; element, resolves it, prepares the environment, and executes the
     fix script. The fix scripts can be either Bash <filename>*.sh</filename> files
     or Ansible playbook <filename>*.yml</filename> files.
    </para>
   </step>
   <step>
    <para>
     After the execution of the script, the respective rule is evaluated again to check if the fix was
     successful.
    </para>
   </step>
  </procedure>
  <para>
   All results of the remediation are stored in an output XCCDF file.
  </para>
  <para>
   For remediating a target system with <command>oscap</command>, you have the following options:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     You can remediate a target system while you are scanning it. In this case, evaluation and
     remediation are performed as a part of a single command.</para>
   </listitem>
   <listitem>
    <para>
     You can remediate a target system after you have scanned it. In the first step, the system is only evaluated,
     and the results are stored in the XCCDF results file. In the second step,
     <command>oscap</command> executes the fix scripts and verifies the result.
    </para>
   </listitem>
   <listitem>
    <para>
     The review mode allows to save remediation instructions to a file for further review. The remediation content
     is not executed during this operation.
    </para>
   </listitem>
  </itemizedlist>
  <!--taroth 2022-10-24: add code examples for oscap commands-->
 </sect1>

 <sect1 xml:id="openscap-terminology">
  <title>Terminology</title>
 <remark>taroth 2022-10-07: some terms to add: DISA, STIG, HIPAA, PCI-DSS, OVAL, XCCDF,
  CPE, DS </remark>
  <variablelist>
    <varlistentry>
     <term>Security Content Automation Protocol (SCAP)</term>
     <listitem>
      <para>
       A framework of specifications that support automated configuration, vulnerability scanning,
       and policy compliance evaluation of systems deployed in an organization.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>National Institute of Standards and Technology (NIST)</term>
     <listitem>
      <para>A physical sciences laboratory and non-regulatory agency of the United States Department of Commerce.</para>
     </listitem>
    </varlistentry>
   <!--<varlistentry>
    <term>Policy</term>
    <listitem>
     <para>TBD</para>
    </listitem>
   </varlistentry>
    <varlistentry>
     <term>Profile</term>
     <listitem>
      <para>A set of recommendations or a set of rules.</para>
     </listitem>
    </varlistentry>
   <varlistentry>
     <term>Rule</term>
     <listitem>
      <para>TBD</para>
     </listitem>
    </varlistentry>-->
  </variablelist>
 </sect1>

 <sect1 xml:id="hipaa-related-topics">
  <title>Related topics</title>

  <itemizedlist>
   <listitem>
    <para>Check out the <citetitle>SCAP Security Guide</citetitle> online
     at <link
     xlink:href="https://www.open-scap.org/security-policies/scap-security-guide/"/>.
     Alternatively, access it from your system after installing the
     <package>scap-security-guide</package> package.
    </para>
   </listitem>
   <listitem>
    <para>For general instructions how to use the <literal>SCAP Security
     Guide</literal>, see the README in <link
      xlink:href="https://github.com/ComplianceAsCode/content"/>.
    </para>
   </listitem>
   <listitem>
    <para>
    </para>
   </listitem>
   <listitem>
    <para>
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <xi:include href="common_copyright_quick.xml"/>
 <xi:include href="common_license_gfdl1.2.xml"/>
</article>
